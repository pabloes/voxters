export default(function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:0,exports:{}};e[i].call(r.exports,r,r.exports,n);r.l=1;return r.exports}n.m=e;n.c=t;n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:1,get:i})};n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:1})};n.t=function(e,t){1&t&&(e=n(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);n.r(i);Object.defineProperty(i,"default",{enumerable:1,value:e});if(2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getMetadataFromIndexes=t.getMetadataFromDna=t.getEncoder=t.encode=t.getDna=t.maximumNumber=t.decode=t.COLOR=t.authors=t.properties=t.propertySizes=void 0;t.propertySizes=[64,64,7,9];t.properties=["eye","mouth","eye_color","head"];t.authors=["mana-fever.com","dapp-craft.com"];var i;(function(e){e[e["RED"]=0]="RED";e[e["PINK"]=1]="PINK";e[e["YELLOW"]=2]="YELLOW";e[e["WHITE"]=3]="WHITE";e[e["GREEN"]=4]="GREEN";e[e["TURQUOISE"]=5]="TURQUOISE";e[e["BLUE"]=6]="BLUE"})(i=t.COLOR||(t.COLOR={}));function r(e,t){const n=[];let i=0,r=1;for(;i<t.length;){n.push(Math.floor(e/r)%t[i]);r*=t[i];i++}return n}t.decode=r;function o(e){let t=0,n=1;for(;t<e.length;){n*=e[t];t++}return n-1}t.maximumNumber=o;function s({eyeIndex:e,mouthIndex:n,eyeColorIndex:i,headIndex:r}){return a(t.propertySizes,[e,n,i,r])}t.getDna=s;function a(e,t){let n=0,i=0,r=1;for(;n<e.length;){i+=t[n]*r;r*=e[n];n++}return i}t.encode=a;function f(e,t){return function(n){const i=r(n,t);return e.reduce(((e,t,n)=>{e[t]=i[n];return e}),{})}}t.getEncoder=f;function c(e){const[n,i,o,s]=r(e,t.propertySizes);return u({eyeIndex:n,mouthIndex:i,eyeColorIndex:o,headIndex:s})}t.getMetadataFromDna=c;function u({eyeIndex:e,mouthIndex:n,eyeColorIndex:i,headIndex:r}){const o=s({eyeIndex:e,mouthIndex:n,eyeColorIndex:i,headIndex:r}),a=["Red","Pink","Yellow","White","Green","Turquoise","Blue"],f={name:`Voxter ${o}`,description:"Voxter creature of the metaverse",image:`https://mana-fever.com/voxters/v1/image/${o}_350.png`,attributes:[{trait_type:"Eyes",display_type:"number",value:e},{trait_type:"Eyes author",value:c(e)},{trait_type:"Eyes color",value:a[i]},{trait_type:"Mouth",value:n},{trait_type:"Mouth author",value:c(n)}]};r&&(f.attributes=f.attributes.concat([{trait_type:"Head accessory",value:r},{trait_type:"Head accessory author",value:t.authors[r]}]));return f;function c(e){return t.authors[Math.floor(e/8)]}}t.getMetadataFromIndexes=u},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{f(i.next(e))}catch(e){o(e)}}function a(e){try{f(i["throw"](e))}catch(e){o(e)}}function f(e){e.done?n(e.value):r(e.value).then(s,a)}f((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});const r=n(2),o=n(3),s=n(0),a=n(5),f="wss://mana-fever.com/voxters-pet/";class c{constructor(e,t){executeTask((()=>i(this,void 0,void 0,(function*(){const n=JSON.parse(t.host_data),{serverWs:i,serverHttp:c}=n.voxterspet,d=e.getUserData?yield e.getUserData():e.user.data,l=e.getCurrentRealm?(yield e.getCurrentRealm()).displayName:e.server.realm.displayName,p=yield r.getLand(),v=new o.Client(`${i||f}`),y=yield v.joinOrCreate("voxters-lobby",{realm:l,user:d,land:p});void 0;const g={};y.onMessage("hasVoxter",(e=>{void 0;let t={x:1,y:1,z:1};setInterval((()=>{if(!h(t,u(Camera.instance.position))){t=u(Camera.instance.position);y.send(1,t)}}),1e3)}));y.state.supporters.onAdd=(e,t)=>{void 0;const{playerPosition:n,tokenId:i,name:r}=e.toJSON(),{x:o,y:f,z:c}=n,u=s.decode(i,[64,64,7,9]);g[t]={playerPosition:-1===o?new Vector3(1,1,1):new Vector3(o,f,c),voxter:a.createVoxter(r,o,f,c,...u)};e.playerPosition.onChange=e=>{const n=e.reduce(((e,t)=>{e[t.field]=t.value;return e}),{});void 0;n.x&&(g[t].playerPosition.x=n.x);n.y&&(g[t].playerPosition.y=n.y);n.z&&(g[t].playerPosition.z=n.z)}};y.state.supporters.onRemove=(e,t)=>{g[t].voxter.dispose();delete g[t]};const m=1;let w=0;this.updateVoxters=e=>{void 0;w+=e;Object.values(g).forEach((n=>{const{x:i,y:r,z:o}=n.playerPosition,s=new Vector3(i,r+.75,o),a=n.voxter.getEntity().getComponent(Transform),f=s.subtract(a.position).normalize().multiplyByFloats(2*e,2*e,2*e),c=new Vector3(0,.01*Math.cos(3*w),0),u=a.position.add(f).add(c);t(u,s)>m?n.voxter.setPosition(u):n.voxter.setPosition(a.position.add(c));a.rotation=Quaternion.Slerp(a.rotation,Quaternion.LookRotation(s.subtract(a.position)),2*e)}));function t(e,t){const n=e.x-t.x,i=t.z-t.z;return n*n-i*i}}}))))}refreshHost(e){}update(e){void 0;this.updateVoxters&&this.updateVoxters(e)}}t.default=c;function u(e){return{x:Math.floor(e.x),y:Math.floor(e.y),z:Math.floor(e.z)}}function h(e,t){return e.x===t.x&&e.z===t.z&&e.y===t.y}},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{f(i.next(e))}catch(e){o(e)}}function a(e){try{f(i["throw"](e))}catch(e){o(e)}}function f(e){e.done?n(e.value):r(e.value).then(s,a)}f((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.getLand=void 0;const r=()=>i(void 0,void 0,void 0,(function*(){var e,t,n;yield dcl.loadModule("ParcelIdentity");const i=yield dcl.callRpc("ParcelIdentity","getParcel",[]);void 0;return null===(n=null===(t=null===(e=null==i?void 0:i.land)||void 0===e?void 0:e.sceneJsonData)||void 0===t?void 0:t.scene)||void 0===n?void 0:n.base}));t.getLand=r},function(e,t,n){(function(e){(function(e,n){n(t)})(this,(function(t){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer});"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window["globalThis"]=window);var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function r(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{f(i.next(e))}catch(e){o(e)}}function a(e){try{f(i["throw"](e))}catch(e){o(e)}}function f(e){e.done?n(e.value):r(e.value).then(s,a)}f((i=i.apply(e,t||[])).next())}))}function o(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return f([e,t])}}function f(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=2&s[0]?r["return"]:s[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;(r=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];r=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}}function s(e,t){t.headers=e.headers||{};t.statusMessage=e.statusText;t.statusCode=e.status;t.data=e.response}function a(e,t,n){return new Promise((function(i,r){n=n||{};var o=new XMLHttpRequest,a,f,c,u=n.body,h=n.headers||{};n.timeout&&(o.timeout=n.timeout);o.ontimeout=o.onerror=function(e){e.timeout="timeout"==e.type;r(e)};o.open(e,t.href||t);o.onload=function(){c=o.getAllResponseHeaders().trim().split(/[\r\n]+/);s(o,o);for(;f=c.shift();){f=f.split(": ");o.headers[f.shift().toLowerCase()]=f.join(": ")}if((f=o.headers["content-type"])&&~f.indexOf("application/json"))try{o.data=JSON.parse(o.data,n.reviver)}catch(e){s(o,e);return r(e)}(o.status>=400?r:i)(o)};if(typeof FormData<"u"&&u instanceof FormData);else if(u&&"object"==typeof u){h["content-type"]="application/json";u=JSON.stringify(u)}o.withCredentials=!!n.withCredentials;for(a in h)o.setRequestHeader(a,h[a]);o.send(u)}))}var f=a.bind(a,"GET"),c=a.bind(a,"POST"),u=a.bind(a,"PATCH"),h=a.bind(a,"DELETE"),d=a.bind(a,"PUT"),l=h,p=f,v=u,y=c,g=d,m=a,w={del:l,get:p,patch:v,post:y,put:g,send:m},_=Object.freeze(Object.assign(Object.create(null),w,{default:w,del:l,get:p,patch:v,post:y,put:g,send:m})),A=function(e){i(t,e);function t(t,n){var i=e.call(this,n)||this;i.name="ServerError";i.code=t;return i}return t}(Error);function E(e,t){this._offset=t;if(e instanceof ArrayBuffer){this._buffer=e;this._view=new DataView(this._buffer)}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer;this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function O(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((r=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else i+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else i+=String.fromCharCode(a)}return i}E.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t};E.prototype._map=function(e){for(var t="",n={},i=0;i<e;i++)n[t=this._parse()]=this._parse();return n};E.prototype._str=function(e){var t=O(this._view,this._offset,e);this._offset+=e;return t};E.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);this._offset+=e;return t};E.prototype._parse=function(){var e=this._view.getUint8(this._offset++),t,n=0,i=0,r=0,o=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return 0;case 195:return 1;case 196:n=this._view.getUint8(this._offset);this._offset+=1;return this._bin(n);case 197:n=this._view.getUint16(this._offset);this._offset+=2;return this._bin(n);case 198:n=this._view.getUint32(this._offset);this._offset+=4;return this._bin(n);case 199:n=this._view.getUint8(this._offset);i=this._view.getInt8(this._offset+1);this._offset+=2;return[i,this._bin(n)];case 200:n=this._view.getUint16(this._offset);i=this._view.getInt8(this._offset+2);this._offset+=3;return[i,this._bin(n)];case 201:n=this._view.getUint32(this._offset);i=this._view.getInt8(this._offset+4);this._offset+=5;return[i,this._bin(n)];case 202:t=this._view.getFloat32(this._offset);this._offset+=4;return t;case 203:t=this._view.getFloat64(this._offset);this._offset+=8;return t;case 204:t=this._view.getUint8(this._offset);this._offset+=1;return t;case 205:t=this._view.getUint16(this._offset);this._offset+=2;return t;case 206:t=this._view.getUint32(this._offset);this._offset+=4;return t;case 207:r=this._view.getUint32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return r+o;case 208:t=this._view.getInt8(this._offset);this._offset+=1;return t;case 209:t=this._view.getInt16(this._offset);this._offset+=2;return t;case 210:t=this._view.getInt32(this._offset);this._offset+=4;return t;case 211:r=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return r+o;case 212:i=this._view.getInt8(this._offset);this._offset+=1;if(0===i){this._offset+=1;return}return[i,this._bin(1)];case 213:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(2)];case 214:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(4)];case 215:i=this._view.getInt8(this._offset);this._offset+=1;if(0===i){r=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return new Date(r+o)}return[i,this._bin(8)];case 216:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(16)];case 217:n=this._view.getUint8(this._offset);this._offset+=1;return this._str(n);case 218:n=this._view.getUint16(this._offset);this._offset+=2;return this._str(n);case 219:n=this._view.getUint32(this._offset);this._offset+=4;return this._str(n);case 220:n=this._view.getUint16(this._offset);this._offset+=2;return this._array(n);case 221:n=this._view.getUint32(this._offset);this._offset+=4;return this._array(n);case 222:n=this._view.getUint16(this._offset);this._offset+=2;return this._map(n);case 223:n=this._view.getUint32(this._offset);this._offset+=4;return this._map(n)}throw new Error("Could not parse")};function $(e,t){void 0===t&&(t=0);var n=new E(e,t),i=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return i}function I(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)if((i=n.charCodeAt(r))<128)e.setUint8(t++,i);else if(i<2048){e.setUint8(t++,192|i>>6);e.setUint8(t++,128|63&i)}else if(i<55296||i>=57344){e.setUint8(t++,224|i>>12);e.setUint8(t++,128|i>>6&63);e.setUint8(t++,128|63&i)}else{r++;i=65536+((1023&i)<<10|1023&n.charCodeAt(r));e.setUint8(t++,240|i>>18);e.setUint8(t++,128|i>>12&63);e.setUint8(t++,128|i>>6&63);e.setUint8(t++,128|63&i)}}function x(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n}function b(e,t,n){var i=typeof n,r=0,o=0,s=0,a=0,f=0,c=0;if("string"===i){if((f=x(n))<32){e.push(160|f);c=1}else if(f<256){e.push(217,f);c=2}else if(f<65536){e.push(218,f>>8,f);c=3}else{if(!(f<4294967296))throw new Error("String too long");e.push(219,f>>24,f>>16,f>>8,f);c=5}t.push({_str:n,_length:f,_offset:e.length});return c+f}if("number"===i){if(Math.floor(n)!==n||!isFinite(n)){e.push(203);t.push({_float:n,_length:8,_offset:e.length});return 9}if(n>=0){if(n<128){e.push(n);return 1}if(n<256){e.push(204,n);return 2}if(n<65536){e.push(205,n>>8,n);return 3}if(n<4294967296){e.push(206,n>>24,n>>16,n>>8,n);return 5}s=n/Math.pow(2,32)>>0;a=n>>>0;e.push(207,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a);return 9}if(n>=-32){e.push(n);return 1}if(n>=-128){e.push(208,n);return 2}if(n>=-32768){e.push(209,n>>8,n);return 3}if(n>=-2147483648){e.push(210,n>>24,n>>16,n>>8,n);return 5}s=Math.floor(n/Math.pow(2,32));a=n>>>0;e.push(211,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a);return 9}if("object"===i){if(null===n){e.push(192);return 1}if(Array.isArray(n)){if((f=n.length)<16){e.push(144|f);c=1}else if(f<65536){e.push(220,f>>8,f);c=3}else{if(!(f<4294967296))throw new Error("Array too large");e.push(221,f>>24,f>>16,f>>8,f);c=5}for(r=0;r<f;r++)c+=b(e,t,n[r]);return c}if(n instanceof Date){var u=n.getTime();s=Math.floor(u/Math.pow(2,32));a=u>>>0;e.push(215,0,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a);return 10}if(n instanceof ArrayBuffer){if((f=n.byteLength)<256){e.push(196,f);c=2}else if(f<65536){e.push(197,f>>8,f);c=3}else{if(!(f<4294967296))throw new Error("Buffer too large");e.push(198,f>>24,f>>16,f>>8,f);c=5}t.push({_bin:n,_length:f,_offset:e.length});return c+f}if("function"==typeof n.toJSON)return b(e,t,n.toJSON());var h=[],d="",l=Object.keys(n);for(r=0,o=l.length;r<o;r++)"function"!=typeof n[d=l[r]]&&h.push(d);if((f=h.length)<16){e.push(128|f);c=1}else if(f<65536){e.push(222,f>>8,f);c=3}else{if(!(f<4294967296))throw new Error("Object too large");e.push(223,f>>24,f>>16,f>>8,f);c=5}for(r=0;r<f;r++){c+=b(e,t,d=h[r]);c+=b(e,t,n[d])}return c}if("boolean"===i){e.push(n?195:194);return 1}if("undefined"===i){e.push(212,0,0);return 3}throw new Error("Could not encode")}function C(e){var t=[],n=[],i=b(t,n,e),r=new ArrayBuffer(i),o=new DataView(r),s=0,a=0,f=-1;n.length>0&&(f=n[0]._offset);for(var c,u=0,h=0,d=0,l=t.length;d<l;d++){o.setUint8(a+d,t[d]);if(d+1===f){u=(c=n[s])._length;h=a+f;if(c._bin)for(var p=new Uint8Array(c._bin),v=0;v<u;v++)o.setUint8(h+v,p[v]);else c._str?I(o,h,c._str):void 0!==c._float&&o.setFloat64(h,c._float);a+=u;n[++s]&&(f=n[s]._offset)}}return r}var R=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},T=globalThis.WebSocket||R,P=function(){function e(e){this.events=e}e.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)};e.prototype.connect=function(e){this.ws=new T(e,this.protocols);this.ws.binaryType="arraybuffer";this.ws.onopen=this.events.onopen;this.ws.onmessage=this.events.onmessage;this.ws.onclose=this.events.onclose;this.ws.onerror=this.events.onerror};e.prototype.close=function(e,t){this.ws.close(e,t)};return e}(),S=function(){function e(){this.events={};this.transport=new P(this.events)}e.prototype.send=function(e){this.transport.send(e)};e.prototype.connect=function(e){this.transport.connect(e)};e.prototype.close=function(e,t){this.transport.close(e,t)};return e}(),M={};function N(e,t){M[e]=t}function D(e){var t=M[e];if(!t)throw new Error("missing serializer: "+e);return t}t.Protocol=void 0;(function(e){e[e["HANDSHAKE"]=9]="HANDSHAKE";e[e["JOIN_ROOM"]=10]="JOIN_ROOM";e[e["ERROR"]=11]="ERROR";e[e["LEAVE_ROOM"]=12]="LEAVE_ROOM";e[e["ROOM_DATA"]=13]="ROOM_DATA";e[e["ROOM_STATE"]=14]="ROOM_STATE";e[e["ROOM_STATE_PATCH"]=15]="ROOM_STATE_PATCH";e[e["ROOM_DATA_SCHEMA"]=16]="ROOM_DATA_SCHEMA"})(t.Protocol||(t.Protocol={}));t.ErrorCode=void 0;(function(e){e[e["MATCHMAKE_NO_HANDLER"]=4210]="MATCHMAKE_NO_HANDLER";e[e["MATCHMAKE_INVALID_CRITERIA"]=4211]="MATCHMAKE_INVALID_CRITERIA";e[e["MATCHMAKE_INVALID_ROOM_ID"]=4212]="MATCHMAKE_INVALID_ROOM_ID";e[e["MATCHMAKE_UNHANDLED"]=4213]="MATCHMAKE_UNHANDLED";e[e["MATCHMAKE_EXPIRED"]=4214]="MATCHMAKE_EXPIRED";e[e["AUTH_FAILED"]=4215]="AUTH_FAILED";e[e["APPLICATION_ERROR"]=4216]="APPLICATION_ERROR"})(t.ErrorCode||(t.ErrorCode={}));function k(e,t){for(var n=e[t++],i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}function j(e){void 0===e&&(e="");for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n+1}let L=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){(this.events[e]=this.events[e]||[]).push(t);return()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var U=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach((function(n){return n.apply(e,t)}))};e.prototype.invokeAsync=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map((function(n){return n.apply(e,t)})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}();function F(){var e=new U;function t(t){return e.register(t,null===this)}t.once=function(t){var n=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];t.apply(this,i);e.remove(n)};e.register(n)};t.remove=function(t){return e.remove(t)};t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)};t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)};t.clear=function(){return e.clear()};return t}var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{};function V(e){var t={exports:{}};return e(t,t.exports),t.exports}var z=V((function(e,t){(function(e,n){n(t)})(H,(function(e){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function i(){this.constructor=e}e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function i(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}function r(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e}var o=255,s=213;e.OPERATION=void 0;(function(e){e[e["ADD"]=128]="ADD";e[e["REPLACE"]=0]="REPLACE";e[e["DELETE"]=64]="DELETE";e[e["DELETE_AND_ADD"]=192]="DELETE_AND_ADD";e[e["TOUCH"]=1]="TOUCH";e[e["CLEAR"]=10]="CLEAR"})(e.OPERATION||(e.OPERATION={}));var a=function(){function e(){this.refs=new Map;this.refCounts={};this.deletedRefs=new Set;this.nextUniqueId=0}e.prototype.getNextUniqueId=function(){return this.nextUniqueId++};e.prototype.addRef=function(e,t,n){void 0===n&&(n=1);this.refs.set(e,t);n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)};e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1;this.deletedRefs.add(e)};e.prototype.clearRefs=function(){this.refs.clear();this.deletedRefs.clear();this.refCounts={}};e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(t){if(e.refCounts[t]<=0){var n=e.refs.get(t);if(n instanceof xe)for(var i in n["_definition"].schema)"string"!=typeof n["_definition"].schema[i]&&n[i]&&n[i]["$changes"]&&e.removeRef(n[i]["$changes"].refId);else{var r=n["$changes"].parent._definition,o=r.schema[r.fieldsByIndex[n["$changes"].parentIndex]];"function"==typeof Object.values(o)[0]&&Array.from(n.values()).forEach((function(t){return e.removeRef(t["$changes"].refId)}))}e.refs.delete(t);delete e.refCounts[t]}}));this.deletedRefs.clear()};return e}(),f=function(){function t(e,t,n){this.changed=0;this.changes=new Map;this.allChanges=new Set;this.caches={};this.currentCustomOperation=0;this.ref=e;this.setParent(t,n)}t.prototype.setParent=function(e,t,n){var i=this;this.indexes||(this.indexes=this.ref instanceof xe?this.ref["_definition"].indexes:{});this.parent=e;this.parentIndex=n;if(t){this.root=t;if(this.ref instanceof xe){var r=this.ref["_definition"];for(var o in r.schema){var s=this.ref[o];if(s&&s["$changes"]){var a=r.indexes[o];s["$changes"].setParent(this.ref,t,a)}}}else"object"==typeof this.ref&&this.ref.forEach((function(e,t){if(e instanceof xe){var n=e["$changes"],r=i.ref["$changes"].indexes[t];n.setParent(i.ref,i.root,r)}}))}};t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)};t.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var r=this.changes.get(i);r&&r.op!==e.OPERATION.DELETE&&r.op!==e.OPERATION.TOUCH||this.changes.set(i,{op:r&&r.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:i});this.allChanges.add(i);this.changed=1;this.touchParents()};t.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t);this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n});this.allChanges.add(n);this.touchParents()};t.prototype.touchParents=function(){this.parent&&this.parent["$changes"].touch(this.parentIndex)};t.prototype.getType=function(e){if(this.ref["_definition"]){var t;return(t=this.ref["_definition"]).schema[t.fieldsByIndex[e]]}var t,n=(t=this.parent["_definition"]).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]};t.prototype.getChildrenFilter=function(){var e=this.parent["_definition"].childFilters;return e&&e[this.parentIndex]};t.prototype.getValue=function(e){return this.ref["getByIndex"](e)};t.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n});this.allChanges.delete(n);delete this.caches[n];i&&i["$changes"]&&(i["$changes"].parent=void 0);this.changed=1;this.touchParents()}else void 0};t.prototype.discard=function(t,n){var i=this;void 0===t&&(t=0);void 0===n&&(n=0);this.ref instanceof xe||this.changes.forEach((function(t){if(t.op===e.OPERATION.DELETE){var n=i.ref["getIndex"](t.index);delete i.indexes[n]}}));this.changes.clear();this.changed=t;n&&this.allChanges.clear();this.currentCustomOperation=0};t.prototype.discardAll=function(){var e=this;this.changes.forEach((function(t){var n=e.getValue(t.index);n&&n["$changes"]&&n["$changes"].discardAll()}));this.discard()};t.prototype.cache=function(e,t){this.caches[e]=t};t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)};t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())};t.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+t+'"')};return t}(),c=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function u(e){e["$proxy"]=1;return e=new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var i=Array.from(e["$items"].keys()),r=parseInt(i[t]||t);null==n?e.deleteAt(r):e.setAt(r,n)}return 1},deleteProperty:function(e,t){"number"==typeof t?e.deleteAt(t):delete e[t];return 1}})}var h=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new f(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;this.push.apply(this,e)}t.is=function(e){return Array.isArray(e)||void 0!==e["array"]};Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:0,configurable:1});t.prototype.push=function(){for(var e=this,t=[],n=0,i;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){i=e.$refId++;e.setAt(i,t)}));return i};t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e);this.$indexes.delete(e);var t=this.$items.get(e);this.$items.delete(e);return t}};t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)};t.prototype.setAt=function(t,n){var i,r;void 0!==n["$changes"]&&n["$changes"].setParent(this,this.$changes.root,t);var o=null!==(r=null===(i=this.$changes.indexes[t])||void 0===i?void 0:i.op)&&void 0!==r?r:e.OPERATION.ADD;this.$changes.indexes[t]=t;this.$indexes.set(t,t);this.$items.set(t,n);this.$changes.change(t,o)};t.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0===t?0:this.$deleteAt(t)};t.prototype.$deleteAt=function(e){this.$changes.delete(e);this.$indexes.delete(e);return this.$items.delete(e)};t.prototype.clear=function(t){var n=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:e.OPERATION.CLEAR});this.$changes.touchParents()};t.prototype.concat=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(t.bind.apply(t,r([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))};t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)};t.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys()),n;Array.from(this.$items.values()).reverse().forEach((function(n,i){e.setAt(t[i],n)}));return this};t.prototype.shift=function(){var e,t=Array.from(this.$items.keys()).shift();if(void 0!==t){var n=this.$items.get(t);this.$deleteAt(t);return n}};t.prototype.slice=function(e,n){return new(t.bind.apply(t,r([void 0],Array.from(this.$items.values()).slice(e,n))))};t.prototype.sort=function(e){var t=this;void 0===e&&(e=c);var n=Array.from(this.$items.keys()),i;Array.from(this.$items.values()).sort(e).forEach((function(e,i){t.setAt(n[i],e)}));return this};t.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=Array.from(this.$items.keys()),o=[],s=e;s<e+t;s++){o.push(this.$items.get(r[s]));this.$deleteAt(r[s])}return o};t.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.length,r=t.length,o=Array.from(this.$items.values());t.forEach((function(t,n){e.setAt(n,t)}));o.forEach((function(t,n){e.setAt(r+n,t)}));return i+r};t.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)};t.prototype.lastIndexOf=function(e,t){void 0===t&&(t=this.length-1);return Array.from(this.$items.values()).lastIndexOf(e,t)};t.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)};t.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)};t.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)};t.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)};t.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)};t.prototype.reduce=function(e,t){return Array.from(this.$items.values()).reduce(e,t)};t.prototype.reduceRight=function(e,t){return Array.from(this.$items.values()).reduceRight(e,t)};t.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)};t.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)};t.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")};t.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")};t.prototype.toString=function(){return this.$items.toString()};t.prototype.toLocaleString=function(){return this.$items.toLocaleString()};t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()};t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()};t.prototype.entries=function(){return this.$items.entries()};t.prototype.keys=function(){return this.$items.keys()};t.prototype.values=function(){return this.$items.values()};t.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)};t.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")};t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")};t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};t.prototype.getIndex=function(e){return this.$indexes.get(e)};t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};t.prototype.toArray=function(){return Array.from(this.$items.values())};t.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"==typeof e["toJSON"]?e["toJSON"]():e}))};t.prototype.clone=function(e){var n;return n=e?new(t.bind.apply(t,r([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,r([void 0],this.map((function(e){return e["$changes"]?e.clone():e})))))};t.prototype.triggerAll=function(){xe.prototype.triggerAll.apply(this)};return t}();function d(e){e["$proxy"]=1;return e=new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&"undefined"==typeof e[t]?e.get(t):e[t]},set:function(e,t,n){"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n;return 1},deleteProperty:function(e,t){e.delete(t);return 1}})}var l=function(){function t(e){var t=this;this.$changes=new f(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;if(e)if(e instanceof Map)e.forEach((function(e,n){return t.set(n,e)}));else for(var n in e)this.set(n,e[n])}t.is=function(e){return void 0!==e["map"]};t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()};Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:0,configurable:1});t.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('"+t+"', "+n+"): trying to set "+n+" value on '"+t+"'.");var i="undefined"!=typeof this.$changes.indexes[t],r=i?this.$changes.indexes[t]:this.$refId++,o=i?e.OPERATION.REPLACE:e.OPERATION.ADD,s=void 0!==n["$changes"];s&&n["$changes"].setParent(this,this.$changes.root,r);if(i)s&&this.$items.get(t)!==n&&(o=e.OPERATION.ADD);else{this.$changes.indexes[t]=r;this.$indexes.set(r,t)}this.$items.set(t,n);this.$changes.change(t,o);return this};t.prototype.get=function(e){return this.$items.get(e)};t.prototype.delete=function(e){this.$changes.delete(e);return this.$items.delete(e)};t.prototype.clear=function(t){var n=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:e.OPERATION.CLEAR});this.$changes.touchParents()};t.prototype.has=function(e){return this.$items.has(e)};t.prototype.forEach=function(e){this.$items.forEach(e)};t.prototype.entries=function(){return this.$items.entries()};t.prototype.keys=function(){return this.$items.keys()};t.prototype.values=function(){return this.$items.values()};Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};t.prototype.getIndex=function(e){return this.$indexes.get(e)};t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};t.prototype.toJSON=function(){var e={};this.forEach((function(t,n){e[n]="function"==typeof t["toJSON"]?t["toJSON"]():t}));return e};t.prototype.clone=function(e){var n;if(e)n=Object.assign(new t,this);else{n=new t;this.forEach((function(e,t){e["$changes"]?n.set(t,e["clone"]()):n.set(t,e)}))}return n};t.prototype.triggerAll=function(){xe.prototype.triggerAll.apply(this)};return t}(),p={};function v(e,t){p[e]=t}function y(e){return p[e]}var g=function(){function e(){this.indexes={};this.fieldsByIndex={};this.deprecated={};this.descriptors={}}e.create=function(t){var n=new e;n.schema=Object.assign({},t&&t.schema||{});n.indexes=Object.assign({},t&&t.indexes||{});n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{});n.descriptors=Object.assign({},t&&t.descriptors||{});n.deprecated=Object.assign({},t&&t.deprecated||{});return n};e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e;this.indexes[e]=n;this.schema[e]=Array.isArray(t)?{array:t[0]}:t};e.prototype.addFilter=function(e,t){if(!this.filters){this.filters={};this.indexesWithFilters=[]}this.filters[this.indexes[e]]=t;this.indexesWithFilters.push(this.indexes[e]);return 1};e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],i=this.schema[e];if(y(Object.keys(i)[0])){this.childFilters||(this.childFilters={});this.childFilters[n]=t;return 1}void 0};e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]};e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length};return e}();function m(e){return e._context&&e._context.useFilters}var w=function(){function e(){this.types={};this.schemas=new Map;this.useFilters=0}e.prototype.has=function(e){return this.schemas.has(e)};e.prototype.get=function(e){return this.types[e]};e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size);e._definition=g.create(e._definition);e._typeid=t;this.types[t]=e;this.schemas.set(e,t)};e.create=function(t){void 0===t&&(t=new e);return function(e){return A(e,t)}};return e}(),_=new w;function A(e,t){void 0===t&&(t=_);return function(n,i){var o=n.constructor;o._context=t;t.has(o)||t.add(o);var s=o._definition;s.addField(i,e);if(s.descriptors[i]){if(s.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+o.name+"'.\nCheck @type() annotation")}catch(e){var a=e.stack.split("\n")[4].trim();throw new Error(e.message+" "+a)}}var f=h.is(e),c=!f&&l.is(e);if("string"!=typeof e&&!xe.is(e)){var p=Object.values(e)[0];"string"==typeof p||t.has(p)||t.add(p)}var v="_"+i;s.descriptors[v]={enumerable:0,configurable:0,writable:1};s.descriptors[i]={get:function(){return this[v]},set:function(e){if(e!==this[v]){if(null!=e){!f||e instanceof h||(e=new(h.bind.apply(h,r([void 0],e))));!c||e instanceof l||(e=new l(e));void 0===e["$proxy"]&&(c?e=d(e):f&&(e=u(e)));this.$changes.change(i);e["$changes"]&&e["$changes"].setParent(this,this.$changes.root,this._definition.indexes[i])}else this.$changes.delete(i);this[v]=e}},enumerable:1,configurable:1}}}function E(e){return function(t,n){var i=t.constructor,r;i._definition.addFilter(n,e)&&(i._context.useFilters=1)}}function O(e){return function(t,n){var i=t.constructor,r;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=1)}}function $(e,t){void 0===e&&(e=1);return function(t,n){var i,r=t.constructor._definition;r.deprecated[n]=1;e&&(r.descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:0,configurable:1})}}function I(e,t,n){void 0===n&&(n=e._context||_);for(var i in t)A(t[i],n)(e.prototype,i);return e}function x(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n}function b(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)if((i=n.charCodeAt(r))<128)e[t++]=i;else if(i<2048){e[t++]=192|i>>6;e[t++]=128|63&i}else if(i<55296||i>=57344){e[t++]=224|i>>12;e[t++]=128|i>>6&63;e[t++]=128|63&i}else{r++;i=65536+((1023&i)<<10|1023&n.charCodeAt(r));e[t++]=240|i>>18;e[t++]=128|i>>12&63;e[t++]=128|i>>6&63;e[t++]=128|63&i}}function C(e,t){e.push(255&t)}function R(e,t){e.push(255&t)}function T(e,t){e.push(255&t);e.push(t>>8&255)}function P(e,t){e.push(255&t);e.push(t>>8&255)}function S(e,t){e.push(255&t);e.push(t>>8&255);e.push(t>>16&255);e.push(t>>24&255)}function M(e,t){var n=t>>24,i=t>>16,r=t>>8,o=t;e.push(255&o);e.push(255&r);e.push(255&i);e.push(255&n)}function N(e,t){var n=Math.floor(t/Math.pow(2,32)),i;M(e,t>>>0);M(e,n)}function D(e,t){var n=t/Math.pow(2,32)>>0,i;M(e,t>>>0);M(e,n)}function k(e,t){H(e,t)}function j(e,t){V(e,t)}var L=new Int32Array(2),U=new Float32Array(L.buffer),F=new Float64Array(L.buffer);function H(e,t){U[0]=t;S(e,L[0])}function V(e,t){F[0]=t;S(e,L[0]);S(e,L[1])}function z(e,t){return R(e,t?1:0)}function B(e,t){t||(t="");var n=x(t),i=0;if(n<32){e.push(160|n);i=1}else if(n<256){e.push(217);R(e,n);i=2}else if(n<65536){e.push(218);P(e,n);i=3}else{if(!(n<4294967296))throw new Error("String too long");e.push(219);M(e,n);i=5}b(e,e.length,t);return i+n}function J(e,t){if(isNaN(t))return J(e,0);if(!isFinite(t))return J(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);if(t!==(0|t)){e.push(203);V(e,t);return 9}if(t>=0){if(t<128){R(e,t);return 1}if(t<256){e.push(204);R(e,t);return 2}if(t<65536){e.push(205);P(e,t);return 3}if(t<4294967296){e.push(206);M(e,t);return 5}e.push(207);D(e,t);return 9}if(t>=-32){e.push(224|t+32);return 1}if(t>=-128){e.push(208);C(e,t);return 2}if(t>=-32768){e.push(209);T(e,t);return 3}if(t>=-2147483648){e.push(210);S(e,t);return 5}e.push(211);N(e,t);return 9}var q=Object.freeze({__proto__:null,utf8Write:b,int8:C,uint8:R,int16:T,uint16:P,int32:S,uint32:M,int64:N,uint64:D,float32:k,float64:j,writeFloat32:H,writeFloat64:V,boolean:z,string:B,number:J});function W(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a))if(240!=(248&a))void 0;else if((r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r);else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}function K(e,t){return G(e,t)<<24>>24}function G(e,t){return e[t.offset++]}function Q(e,t){return X(e,t)<<16>>16}function X(e,t){return e[t.offset++]|e[t.offset++]<<8}function Y(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function Z(e,t){return Y(e,t)>>>0}function ee(e,t){return ae(e,t)}function te(e,t){return fe(e,t)}function ne(e,t){var n=Z(e,t),i;return Y(e,t)*Math.pow(2,32)+n}function ie(e,t){var n=Z(e,t),i;return Z(e,t)*Math.pow(2,32)+n}var re=new Int32Array(2),oe=new Float32Array(re.buffer),se=new Float64Array(re.buffer);function ae(e,t){re[0]=Y(e,t);return oe[0]}function fe(e,t){re[0]=Y(e,t);re[1]=Y(e,t);return se[0]}function ce(e,t){return G(e,t)>0}function ue(e,t){var n=e[t.offset++],i;n<192?i=31&n:217===n?i=G(e,t):218===n?i=X(e,t):219===n&&(i=Z(e,t));var r=W(e,t.offset,i);t.offset+=i;return r}function he(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}function de(e,t){var n=e[t.offset++];return n<128?n:202===n?ae(e,t):203===n?fe(e,t):204===n?G(e,t):205===n?X(e,t):206===n?Z(e,t):207===n?ie(e,t):208===n?K(e,t):209===n?Q(e,t):210===n?Y(e,t):211===n?ne(e,t):n>223?-1*(255-n+1):void 0}function le(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}function pe(e,t){return e[t.offset]<160}function ve(e,t){return e[t.offset-1]===o&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var ye=Object.freeze({__proto__:null,int8:K,uint8:G,int16:Q,uint16:X,int32:Y,uint32:Z,float32:ee,float64:te,int64:ne,uint64:ie,readFloat32:ae,readFloat64:fe,boolean:ce,string:ue,stringCheck:he,number:de,numberCheck:le,arrayCheck:pe,switchStructureCheck:ve}),ge=function(){function t(e){var t=this;this.$changes=new f(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;e&&e.forEach((function(e){return t.add(e)}))}t.is=function(e){return void 0!==e["collection"]};t.prototype.add=function(e){var t=this.$refId++,n;void 0!==e["$changes"]&&e["$changes"].setParent(this,this.$changes.root,t);this.$changes.indexes[t]=t;this.$indexes.set(t,t);this.$items.set(t,e);this.$changes.change(t);return t};t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)};t.prototype.entries=function(){return this.$items.entries()};t.prototype.delete=function(e){for(var t=this.$items.entries(),n,i;(i=t.next())&&!i.done;)if(e===i.value[1]){n=i.value[0];break}if(void 0===n)return 0;this.$changes.delete(n);this.$indexes.delete(n);return this.$items.delete(n)};t.prototype.clear=function(t){var n=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:e.OPERATION.CLEAR});this.$changes.touchParents()};t.prototype.has=function(e){return Array.from(this.$items.values()).some((function(t){return t===e}))};t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,r){return e(n,i,t)}))};t.prototype.values=function(){return this.$items.values()};Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};t.prototype.getIndex=function(e){return this.$indexes.get(e)};t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};t.prototype.toArray=function(){return Array.from(this.$items.values())};t.prototype.toJSON=function(){var e=[];this.forEach((function(t,n){e.push("function"==typeof t["toJSON"]?t["toJSON"]():t)}));return e};t.prototype.clone=function(e){var n;if(e)n=Object.assign(new t,this);else{n=new t;this.forEach((function(e){e["$changes"]?n.add(e["clone"]()):n.add(e)}))}return n};t.prototype.triggerAll=function(){xe.prototype.triggerAll.apply(this)};return t}(),me=function(){function t(e){var t=this;this.$changes=new f(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;e&&e.forEach((function(e){return t.add(e)}))}t.is=function(e){return void 0!==e["set"]};t.prototype.add=function(t){var n,i;if(this.has(t))return 0;var r=this.$refId++;void 0!==t["$changes"]&&t["$changes"].setParent(this,this.$changes.root,r);var o=null!==(i=null===(n=this.$changes.indexes[r])||void 0===n?void 0:n.op)&&void 0!==i?i:e.OPERATION.ADD;this.$changes.indexes[r]=r;this.$indexes.set(r,r);this.$items.set(r,t);this.$changes.change(r,o);return r};t.prototype.entries=function(){return this.$items.entries()};t.prototype.delete=function(e){for(var t=this.$items.entries(),n,i;(i=t.next())&&!i.done;)if(e===i.value[1]){n=i.value[0];break}if(void 0===n)return 0;this.$changes.delete(n);this.$indexes.delete(n);return this.$items.delete(n)};t.prototype.clear=function(t){var n=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:e.OPERATION.CLEAR});this.$changes.touchParents()};t.prototype.has=function(e){for(var t=this.$items.values(),n=0,i;(i=t.next())&&!i.done;)if(e===i.value){n=1;break}return n};t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,r){return e(n,i,t)}))};t.prototype.values=function(){return this.$items.values()};Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};t.prototype.getIndex=function(e){return this.$indexes.get(e)};t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};t.prototype.toArray=function(){return Array.from(this.$items.values())};t.prototype.toJSON=function(){var e=[];this.forEach((function(t,n){e.push("function"==typeof t["toJSON"]?t["toJSON"]():t)}));return e};t.prototype.clone=function(e){var n;if(e)n=Object.assign(new t,this);else{n=new t;this.forEach((function(e){e["$changes"]?n.add(e["clone"]()):n.add(e)}))}return n};t.prototype.triggerAll=function(){xe.prototype.triggerAll.apply(this)};return t}(),we=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))};e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}(),_e=function(){function e(){this.refIds=new WeakSet;this.containerIndexes=new WeakMap}e.prototype.addRefId=function(e){if(!this.refIds.has(e)){this.refIds.add(e);this.containerIndexes.set(e,new Set)}};e.get=function(t){void 0===t.$filterState&&(t.$filterState=new e);return t.$filterState};return e}(),Ae=function(e){n(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);function Ee(e,t,n,i){var r,o=0;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number";isNaN(e),0;break;case"string":r="string";o=1;break;case"boolean":return}if(typeof e!==r&&(!o||o&&null!==e)){var s="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new Ae("a '"+r+"' was expected, but "+s+" was provided in "+n.constructor.name+"#"+i)}}function Oe(e,t,n,i){if(!(e instanceof t))throw new Ae("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function $e(e,t,n,i,r){Ee(n,e,i,r);var o=q[e];if(!o)throw new Ae("a '"+e+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+r);o(t,n)}function Ie(e,t,n){return ye[e](t,n)}var xe=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new f(this,void 0,new a),enumerable:0,writable:1},$listeners:{value:{},enumerable:0,writable:1}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n);e[0]&&this.assign(e[0])}t.onError=function(e){void 0};t.is=function(e){return e["_definition"]&&void 0!==e["_definition"].schema};t.prototype.assign=function(e){Object.assign(this,e);return this};Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:0,configurable:1});t.prototype.listen=function(e,t){var n=this;this.$listeners[e]||(this.$listeners[e]=new we);this.$listeners[e].register(t);return function(){return n.$listeners[e].remove(t)}};t.prototype.decode=function(n,i,r,s){void 0===i&&(i={offset:0});void 0===r&&(r=this);void 0===s&&(s=new Map);var a=this.$changes.root,f=n.length,c=0,u=[];a.refs.set(c,this);s.set(c,u);for(;i.offset<f;){var d=n[i.offset++];if(d!=o){var p=r["$changes"],v=void 0!==r["_definition"],g=v?d>>6<<6:d;if(g!==e.OPERATION.CLEAR){var m=v?d%(g||255):de(n,i),w=v?r["_definition"].fieldsByIndex[m]:"",_=p.getType(m),A=void 0,E=void 0,O=void 0;if(v)E=r["_"+w];else{E=r["getByIndex"](m);if((g&e.OPERATION.ADD)===e.OPERATION.ADD){O=r instanceof l?ue(n,i):m;r["setIndex"](m,O)}else O=r["getIndex"](m)}if((g&e.OPERATION.DELETE)===e.OPERATION.DELETE){g!==e.OPERATION.DELETE_AND_ADD&&r["deleteByIndex"](m);E&&E["$changes"]&&a.removeRef(E["$changes"].refId);A=null}if(void 0!==w){if(g===e.OPERATION.DELETE);else if(t.is(_)){var $=de(n,i);A=a.refs.get($);if(g!==e.OPERATION.REPLACE){var I=this.getSchemaType(n,i,_);if(!A){(A=this.createTypeInstance(I)).$changes.refId=$;if(E){A.onChange=E.onChange;A.onRemove=E.onRemove;A.$listeners=E.$listeners;E["$changes"].refId&&$!==E["$changes"].refId&&a.removeRef(E["$changes"].refId)}}a.addRef($,A,A!==E)}}else if("string"==typeof _)A=Ie(_,n,i);else{var x=y(Object.keys(_)[0]),b=de(n,i),C=a.refs.has(b)?E||a.refs.get(b):new x.constructor;(A=C.clone(1)).$changes.refId=b;if(E){A.onAdd=E.onAdd;A.onRemove=E.onRemove;A.onChange=E.onChange;if(E["$changes"].refId&&b!==E["$changes"].refId){a.removeRef(E["$changes"].refId);for(var R=[],T=E.entries(),P=void 0;(P=T.next())&&!P.done;){var S=P.value,M=S[0],N=S[1];R.push({op:e.OPERATION.DELETE,field:M,value:void 0,previousValue:N})}s.set(E["$changes"].refId,R)}}a.addRef(b,A,C!==E);x.getProxy&&(A=x.getProxy(A))}var D=E!==A;if(null!=A){A["$changes"]&&A["$changes"].setParent(p.ref,p.root,m);if(r instanceof t)r[w]=A;else if(r instanceof l){var M=O;r["$items"].set(M,A)}else if(r instanceof h)r.setAt(m,A);else if(r instanceof ge){var k=r.add(A);r["setIndex"](m,k)}else if(r instanceof me){var k;0!=(k=r.add(A))&&r["setIndex"](m,k)}}D&&u.push({op:g,field:w,dynamicIndex:O,value:A,previousValue:E})}else{void 0;for(var j={offset:i.offset};i.offset<f;){if(ve(n,i)){j.offset=i.offset+1;if(a.refs.has(de(n,j)))break}i.offset++}}}else r.clear(1)}else{c=de(n,i);var L=a.refs.get(c);if(!L)throw new Error('"refId" not found: '+c);r=L;u=[];s.set(c,u)}}this._triggerChanges(s);a.garbageCollectDeletedRefs();return s};t.prototype.encode=function(n,i,r){void 0===n&&(n=0);void 0===i&&(i=[]);void 0===r&&(r=0);for(var s=this.$changes,a=new WeakSet,f=[s],c=1,u=0;u<c;u++){var h=f[u],d=h.ref,p=d instanceof t;h.ensureRefId();a.add(h);if(h!==s&&(h.changed||n)){R(i,o);J(i,h.refId)}for(var v=n?Array.from(h.allChanges):Array.from(h.changes.values()),g=0,m=v.length;g<m;g++){var w=n?{op:e.OPERATION.ADD,index:v[g]}:v[g],_=w.index,A=p?d["_definition"].fieldsByIndex&&d["_definition"].fieldsByIndex[_]:_,E=i.length;if(w.op!==e.OPERATION.TOUCH)if(p)R(i,_|w.op);else{R(i,w.op);if(w.op===e.OPERATION.CLEAR)continue;J(i,_)}if(!p&&(w.op&e.OPERATION.ADD)==e.OPERATION.ADD&&d instanceof l){var O;B(i,h.ref["$indexes"].get(_))}if(w.op!==e.OPERATION.DELETE){var $=h.getType(_),I=h.getValue(_);if(I&&I["$changes"]&&!a.has(I["$changes"])){f.push(I["$changes"]);I["$changes"].ensureRefId();c++}if(w.op!==e.OPERATION.TOUCH){if(t.is($)){Oe(I,$,d,A);J(i,I.$changes.refId);(w.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(i,$,I.constructor)}else if("string"==typeof $)$e($,i,I,d,A);else{var x=y(Object.keys($)[0]);Oe(d["_"+A],x.constructor,d,A);J(i,I.$changes.refId)}r&&h.cache(_,i.slice(E))}}}n||r||h.discard()}return i};t.prototype.encodeAll=function(e){return this.encode(1,[],e)};t.prototype.applyFilters=function(n,i){var r,s;void 0===i&&(i=0);for(var a=this,f=new Set,c=_e.get(n),u=[this.$changes],h=1,d=[],p=function(p){var v=u[p];if(f.has(v.refId))return"continue";var y=v.ref,g=y instanceof t;R(d,o);J(d,v.refId);var m=c.refIds.has(v),w=i||!m;c.addRefId(v);var _=c.containerIndexes.get(v),A=w?Array.from(v.allChanges):Array.from(v.changes.values());if(!i&&g&&y._definition.indexesWithFilters){var E;y._definition.indexesWithFilters.forEach((function(t){!_.has(t)&&v.allChanges.has(t)&&(w?A.push(t):A.push({op:e.OPERATION.ADD,index:t}))}))}for(var O=0,$=A.length;O<$;O++){var I=w?{op:e.OPERATION.ADD,index:A[O]}:A[O];if(I.op!==e.OPERATION.CLEAR){var x=I.index;if(I.op!==e.OPERATION.DELETE){var b=v.getValue(x),C=v.getType(x);if(g){var T;if((T=y._definition.filters&&y._definition.filters[x])&&!T.call(y,n,b,a)){b&&b["$changes"]&&f.add(b["$changes"].refId);continue}}else{var P=v.parent,T;if((T=v.getChildrenFilter())&&!T.call(P,n,y["$indexes"].get(x),b,a)){b&&b["$changes"]&&f.add(b["$changes"].refId);continue}}if(b["$changes"]){u.push(b["$changes"]);h++}if(I.op!==e.OPERATION.TOUCH)if(I.op===e.OPERATION.ADD||g){d.push.apply(d,null!==(r=v.caches[x])&&void 0!==r?r:[]);_.add(x)}else if(_.has(x))d.push.apply(d,null!==(s=v.caches[x])&&void 0!==s?s:[]);else{_.add(x);R(d,e.OPERATION.ADD);J(d,x);if(y instanceof l){var S=v.ref["$indexes"].get(x);B(d,S)}b["$changes"]?J(d,b["$changes"].refId):q[C](d,b)}else if(b["$changes"]&&!g){R(d,e.OPERATION.ADD);J(d,x);if(y instanceof l){var S=v.ref["$indexes"].get(x);B(d,S)}J(d,b["$changes"].refId)}}else if(g)R(d,I.op|x);else{R(d,I.op);J(d,x)}}else R(d,I.op)}},v=0;v<h;v++)p(v);return d};t.prototype.clone=function(){var e=new this.constructor,t=this._definition.schema;for(var n in t)"object"==typeof this[n]&&"function"==typeof this[n].clone?e[n]=this[n].clone():e[n]=this[n];return e};t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(e){t.onError(e)}}};t.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var i in e)t[i]||null===this[i]||"undefined"==typeof this[i]||(n[i]="function"==typeof this[i]["toJSON"]?this[i]["toJSON"]():this["_"+i]);return n};t.prototype.discardAllChanges=function(){this.$changes.discardAll()};t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]};t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0};t.prototype.tryEncodeTypeId=function(e,t,n){if(t._typeid!==n._typeid){R(e,s);J(e,n._typeid)}};t.prototype.getSchemaType=function(e,t,n){var i;if(e[t.offset]===s){t.offset++;i=this.constructor._context.get(de(e,t))}return i||n};t.prototype.createTypeInstance=function(e){var t=new e;t.$changes.root=this.$changes.root;return t};t.prototype._triggerAllFillChanges=function(n,i){if(!i.has(n["$changes"].refId)){var r=[];i.set(n["$changes"].refId||0,r);if(n instanceof t){var o=n._definition.schema;for(var s in o){var a,f;if(void 0!==(f=n["_"+s])){r.push({op:e.OPERATION.ADD,field:s,value:f,previousValue:void 0});void 0!==f["$changes"]&&t.prototype._triggerAllFillChanges.call(this,f,i)}}}else for(var c=n.entries(),u=void 0;(u=c.next())&&!u.done;){var h=u.value,d=h[0],f=h[1];r.push({op:e.OPERATION.ADD,field:d,dynamicIndex:d,value:f,previousValue:void 0});void 0!==f["$changes"]&&t.prototype._triggerAllFillChanges.call(this,f,i)}}};t.prototype._triggerChanges=function(n){var i=this;n.forEach((function(n,r){var o,s,a,f,c,u,h,d,l,p,v,y;if(n.length>0){for(var g=i.$changes.root.refs.get(r),m=g instanceof t,w=0;w<n.length;w++){var _=n[w],A=g["$listeners"]&&g["$listeners"][_.field];if(!m)if(_.op===e.OPERATION.ADD&&void 0===_.previousValue)null===(s=(o=g).onAdd)||void 0===s?void 0:s.call(o,_.value,null!==(a=_.dynamicIndex)&&void 0!==a?a:_.field);else if(_.op===e.OPERATION.DELETE)void 0!==_.previousValue&&(null===(c=(f=g).onRemove)||void 0===c?void 0:c.call(f,_.previousValue,null!==(u=_.dynamicIndex)&&void 0!==u?u:_.field));else if(_.op===e.OPERATION.DELETE_AND_ADD){void 0!==_.previousValue&&(null===(d=(h=g).onRemove)||void 0===d?void 0:d.call(h,_.previousValue,_.dynamicIndex));null===(p=(l=g).onAdd)||void 0===p?void 0:p.call(l,_.value,_.dynamicIndex)}else _.op!==e.OPERATION.REPLACE&&_.value===_.previousValue||(null===(y=(v=g).onChange)||void 0===y?void 0:y.call(v,_.value,_.dynamicIndex));(_.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&_.previousValue instanceof t&&_.previousValue.onRemove&&_.previousValue.onRemove();if(A)try{A.invoke(_.value,_.previousValue)}catch(e){t.onError(e)}}if(m&&g.onChange)try{g.onChange(n)}catch(e){t.onError(e)}}}))};t._definition=g.create();return t}();function be(e){for(var t=[e["$changes"]],n=1,i={},r=i,o=function(e){var n=t[e];n.changes.forEach((function(e){var t=n.ref,i=e.index,o=t["_definition"]?t["_definition"].fieldsByIndex[i]:t["$indexes"].get(i);r[o]=n.getValue(i)}))},s=0;s<n;s++)o(s);return i}var Ce=new w,Re=function(e){n(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}i([A("string",Ce)],t.prototype,"name",void 0);i([A("string",Ce)],t.prototype,"type",void 0);i([A("number",Ce)],t.prototype,"referencedType",void 0);return t}(xe),Te=function(e){n(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.fields=new h;return t}i([A("number",Ce)],t.prototype,"id",void 0);i([A([Re],Ce)],t.prototype,"fields",void 0);return t}(xe),Pe=function(e){n(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.types=new h;return t}t.encode=function(e){var n=e.constructor,i=new t;i.rootType=n._typeid;var r=function(e,t){for(var n in t){var r=new Re;r.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var s=t[n],a=void 0;if(xe.is(s)){o="ref";a=t[n]}else"string"==typeof s[o=Object.keys(s)[0]]?o+=":"+s[o]:a=s[o];r.referencedType=a?a._typeid:-1}r.type=o;e.fields.push(r)}i.types.push(e)},o=n._context.types;for(var s in o){var a=new Te;a.id=Number(s);r(a,o[s]._definition.schema)}return i.encodeAll()};t.decode=function(e,i){var r=new w,o=new t;o.decode(e,i);var s=o.types.reduce((function(e,t){var i=function(e){n(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(xe),o=t.id;e[o]=i;r.add(i,o);return e}),{});o.types.forEach((function(e){var t=s[e.id];e.fields.forEach((function(e){var n;if(void 0!==e.referencedType){var i=e.type,o=s[e.referencedType];if(!o){var a=e.type.split(":");i=a[0];o=a[1]}"ref"===i?A(o,r)(t.prototype,e.name):A(((n={})[i]=o,n),r)(t.prototype,e.name)}else A(e.type,r)(t.prototype,e.name)}))}));var a=s[o.rootType],f=new a;for(var c in a._definition.schema){var u=a._definition.schema[c];"string"!=typeof u&&(f[c]="function"==typeof u?new u:new(y(Object.keys(u)[0]).constructor))}return f};i([A([Te],Ce)],t.prototype,"types",void 0);i([A("number",Ce)],t.prototype,"rootType",void 0);return t}(xe);v("map",{constructor:l,getProxy:d});v("array",{constructor:h,getProxy:u});v("set",{constructor:me});v("collection",{constructor:ge});e.ArraySchema=h;e.CollectionSchema=ge;e.Context=w;e.MapSchema=l;e.Reflection=Pe;e.ReflectionField=Re;e.ReflectionType=Te;e.Schema=xe;e.SchemaDefinition=g;e.SetSchema=me;e.decode=ye;e.defineTypes=I;e.deprecated=$;e.dumpChanges=be;e.encode=q;e.filter=E;e.filterChildren=O;e.hasFilter=m;e.registerType=v;e.type=A;Object.defineProperty(e,"__esModule",{value:1})}))})),B=function(){function e(e,t){var n=this;this.onStateChange=F();this.onError=F();this.onLeave=F();this.onJoin=F();this.hasJoined=0;this.onMessageHandlers=L();this.id=null;this.name=e;if(t){this.serializer=new(D("schema"));this.rootSchema=t;this.serializer.state=new t}this.onError((function(e,t){}));this.onLeave((function(){return n.removeAllListeners()}))}e.prototype.connect=function(e){var t=this;this.connection=new S;this.connection.events.onmessage=this.onMessageCallback.bind(this);this.connection.events.onclose=function(e){if(t.hasJoined){t.onLeave.invoke(e.code);t.destroy()}else{void 0;t.onError.invoke(e.code,e.reason)}};this.connection.events.onerror=function(e){void 0;t.onError.invoke(e.code,e.reason)};this.connection.connect(e)};e.prototype.leave=function(e){var n=this;void 0===e&&(e=1);return new Promise((function(i){n.onLeave((function(e){return i(e)}));n.connection?e?n.connection.send([t.Protocol.LEAVE_ROOM]):n.connection.close():n.onLeave.invoke(4e3)}))};e.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)};e.prototype.send=function(e,n){var i=[t.Protocol.ROOM_DATA],r;"string"==typeof e?z.encode.string(i,e):z.encode.number(i,e);if(void 0!==n){var o=C(n);(r=new Uint8Array(i.length+o.byteLength)).set(new Uint8Array(i),0);r.set(new Uint8Array(o),i.length)}else r=new Uint8Array(i);this.connection.send(r.buffer)};Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:0,configurable:1});e.prototype.removeAllListeners=function(){this.onJoin.clear();this.onStateChange.clear();this.onError.clear();this.onLeave.clear();this.onMessageHandlers.events={}};e.prototype.onMessageCallback=function(e){var n=Array.from(new Uint8Array(e.data)),i=n[0];if(i===t.Protocol.JOIN_ROOM){var r=1;this.serializerId=k(n,r);r+=j(this.serializerId);if(!this.serializer){var o=D(this.serializerId);this.serializer=new o}n.length>r&&this.serializer.handshake&&this.serializer.handshake(n,{offset:r});this.hasJoined=1;this.onJoin.invoke();this.connection.send([t.Protocol.JOIN_ROOM])}else if(i===t.Protocol.ERROR){var s={offset:1},a=z.decode.number(n,s),f=z.decode.string(n,s);this.onError.invoke(a,f)}else if(i===t.Protocol.LEAVE_ROOM)this.leave();else if(i===t.Protocol.ROOM_DATA_SCHEMA){var c={offset:1},u,h,f;(f=new(h=this.serializer.getState().constructor._context.get(z.decode.number(n,c)))).decode(n,c);this.dispatchMessage(h,f)}else if(i===t.Protocol.ROOM_STATE){n.shift();this.setState(n)}else if(i===t.Protocol.ROOM_STATE_PATCH){n.shift();this.patch(n)}else if(i===t.Protocol.ROOM_DATA){var d={offset:1},h=z.decode.stringCheck(n,d)?z.decode.string(n,d):z.decode.number(n,d),f=n.length>d.offset?$(e.data,d.offset):void 0;this.dispatchMessage(h,f)}};e.prototype.setState=function(e){this.serializer.setState(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.patch=function(e){this.serializer.patch(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):void 0};e.prototype.destroy=function(){this.serializer&&this.serializer.teardown()};e.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}};return e}(),J;function q(){J||(J="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}});return J}function W(e,t){q().setItem(e,t)}function K(e){q().removeItem(e)}function G(e,t){var n=q().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((function(e){return t(e)})):t(n)}var Q="colyseus-auth-token";t.Platform=void 0;(function(e){e["ios"]="ios";e["android"]="android"})(t.Platform||(t.Platform={}));var X=function(){function e(e){var t=this;this._id=void 0;this.username=void 0;this.displayName=void 0;this.avatarUrl=void 0;this.isAnonymous=void 0;this.email=void 0;this.lang=void 0;this.location=void 0;this.timezone=void 0;this.metadata=void 0;this.devices=void 0;this.facebookId=void 0;this.twitterId=void 0;this.googleId=void 0;this.gameCenterId=void 0;this.steamId=void 0;this.friendIds=void 0;this.blockedUserIds=void 0;this.createdAt=void 0;this.updatedAt=void 0;this.token=void 0;this.endpoint=e.replace("ws","http");G(Q,(function(e){return t.token=e}))}Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:0,configurable:1});e.prototype.login=function(e){void 0===e&&(e={});return r(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){switch(r.label){case 0:t=Object.assign({},e);this.hasToken&&(t.token=this.token);return[4,this.request("post","/auth",t)];case 1:n=r.sent();this.token=n.token;W(Q,this.token);for(i in n)this.hasOwnProperty(i)&&(this[i]=n[i]);this.registerPingService();return[2,this]}}))}))};e.prototype.save=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:e.sent();return[2,this]}}))}))};e.prototype.getFriends=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))};e.prototype.getOnlineFriends=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))};e.prototype.getFriendRequests=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))};e.prototype.sendFriendRequest=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.acceptFriendRequest=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.declineFriendRequest=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.blockUser=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.unblockUser=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.request=function(e,t,n,i,s){void 0===n&&(n={});void 0===s&&(s={});return r(this,void 0,void 0,(function(){var r,a,f,c;return o(this,(function(o){switch(o.label){case 0:s["Accept"]="application/json";this.hasToken&&(s["Authorization"]="Bearer "+this.token);r=[];for(a in n)r.push(a+"="+n[a]);f=r.length>0?"?"+r.join("&"):"";c={headers:s};i&&(c.body=i);return[4,_[e](""+this.endpoint+t+f,c)];case 1:return[2,o.sent().data]}}))}))};e.prototype.logout=function(){this.token=void 0;K(Q);this.unregisterPingService()};e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3);this.unregisterPingService();this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)};e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)};return e}(),Y,Z=function(e){i(t,e);function t(n,i){var r=e.call(this,n)||this;r.code=i;Object.setPrototypeOf(r,t.prototype);return r}return t}(Error),ee="undefined"!=typeof window&&"undefined"!=typeof(null===(Y=null===window||void 0===window?void 0:window.location)||void 0===Y?void 0:Y.hostname)?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",te=function(){function e(e){void 0===e&&(e=ee);this.endpoint=e}Object.defineProperty(e.prototype,"auth",{get:function(){this._auth||(this._auth=new X(this.endpoint));return this._auth},enumerable:0,configurable:1});e.prototype.joinOrCreate=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.create=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.join=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.joinById=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.reconnect=function(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,i.sent()]}}))}))};e.prototype.getAvailableRooms=function(e){void 0===e&&(e="");return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:t=this.endpoint.replace("ws","http")+"/matchmake/"+e;return[4,p(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}}))}))};e.prototype.consumeSeatReservation=function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(i){(n=this.createRoom(e.room.name,t)).id=e.room.roomId;n.sessionId=e.sessionId;n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId}));return[2,new Promise((function(e,t){var i=function(e,n){return t(new A(e,n))};n.onError.once(i);n["onJoin"].once((function(){n.onError.remove(i);e(n)}))}))]}))}))};e.prototype.createMatchMakeRequest=function(e,t,n,i){void 0===n&&(n={});return r(this,void 0,void 0,(function(){var r,s;return o(this,(function(o){switch(o.label){case 0:r=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t;this._auth&&this._auth.hasToken&&(n.token=this._auth.token);return[4,y(r,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((s=o.sent().data).error)throw new Z(s.error,s.code);return[2,this.consumeSeatReservation(s,i)]}}))}))};e.prototype.createRoom=function(e,t){return new B(e,t)};e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i+"="+t[i]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")};return e}(),ne=function(){function e(){}e.prototype.setState=function(e){this.state.decode(e)};e.prototype.getState=function(){return this.state};e.prototype.patch=function(e){this.state.decode(e)};e.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e["$changes"])||void 0===t?void 0:t.root.clearRefs()};e.prototype.handshake=function(e,t){if(this.state){var n;(new z.Reflection).decode(e,t)}else this.state=z.Reflection.decode(e,t)};return e}(),ie=function(){function e(){}e.prototype.setState=function(e){};e.prototype.getState=function(){return null};e.prototype.patch=function(e){};e.prototype.teardown=function(){};e.prototype.handshake=function(e){};return e}();N("schema",ne);N("none",ie);t.Auth=X;t.Client=te;t.Room=B;t.SchemaSerializer=ne;t.registerSerializer=N;Object.defineProperty(t,"__esModule",{value:1})}))}).call(this,n(4))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createVoxter=void 0;const i=n(6),r=n(7),o=n(8),s=n(0),a=["#ff0000","#ff00ff","#ffff00","#ffffff","#00ff00","#00ffff","#0000ff"],f=new Texture("metas/voxterspet/images/sprites2048.png",{samplingMode:1,hasAlpha:1}),c=new Material,u=(e,t,n,u,h,d,l,p)=>{void 0;const v={onClick:null},y=new Entity;c.albedoColor=new Color3(0,0,0);const g=new BoxShape;g.withCollisions=0;const m=new Entity,w=new TextShape;m.addComponent(w);w.value=e;w.fontSize=2;w.outlineColor=Color3.Black();w.outlineWidth=.2;w.font=new Font(Fonts.SanFrancisco_Heavy);w.billboard=1;w.color=Color3.FromHexString(a[l]);m.setParent(y);m.addComponent(new Transform({position:new Vector3(0,1,0)}));y.addComponent(g);y.addComponent(c);const _=new Transform({position:new Vector3(t,n,u),scale:new Vector3(.5,.5,.5)});y.addComponent(_);const A=i.createEyes(y,h,a[l],f),E=r.createMouth(y,d,"#ff00ff",f),O=o.createHead(y,p);engine.addEntity(y);return{onClick:e=>{v.onClick=e},applyDna:e=>{const[t,n,i,r]=s.decode(e,s.propertySizes);A.applyIndex(t);A.applyColor(a[i]);E.applyIndex(n);O.applyIndex(r)},getEntity:()=>y,setPosition:e=>{y.getComponent(Transform).position.copyFrom(e)},dispose:()=>{y.setParent(null);engine.removeEntity(y)},lookAt:e=>{y.getComponent(Transform).lookAt(e)},update:e=>{}}};t.createVoxter=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createEyes=void 0;const i=["#ff0000","#ff00ff","#ffff00","#ffffff","#00ff00","#00ffff","#0000ff"],r=[8,6,4,4,4,4,10],o=(e,t,n,o)=>{const s=new Entity;s.setParent(e);const a=new PlaneShape,f=new Material;a.withCollisions=0;a.uvs=u(t+1);s.addComponent(a);s.addComponent(new Transform({position:new Vector3(0,1/3-.025,.5102),scale:new Vector3(-.95,1/3,-1)}));f.emissiveColor=Color3.FromHexString(n);f.emissiveIntensity=r[i.indexOf(n)];f.albedoTexture=o;f.alphaTexture=o;s.addComponent(f);return{applyIndex:c,applyColor:e=>{f.emissiveColor=Color3.FromHexString(e);f.emissiveIntensity=r[i.indexOf(e)]}};function c(e){a.uvs=u(e+1)}function u(e){let t=8,n=8,i=e,r=178/256,o=.125,s=t*n,a=1/t,f=1/n,c=n-Math.floor((i-1)/t)-o,u=(i-1)%t;const h=u*a,d=(u+1)*a,l=(c-1)*f+r*f,p=c*f;return[0,0,0,0,0,0,0,0,d,l,h,l,h,p,d,p]}};t.createEyes=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createMouth=void 0;const i=new Material;i.specularIntensity=0;i.roughness=1;i.emissiveIntensity=1.2;i.emissiveColor=new Color3(1,1,1);const r=(e,t,n,r)=>{if(!i.albedoTexture){i.albedoTexture=r;i.alphaTexture=r;i.emissiveTexture=r}const o=new PlaneShape,s=new Entity;s.setParent(e);o.withCollisions=0;o.uvs=a(t+1);s.addComponent(o);s.addComponent(new Transform({position:new Vector3(0,-1/3/2,.5002),scale:new Vector3(-.95,1*(2/3-.05),-1)}));s.addComponent(i);return{applyIndex:e=>{o.uvs=a(e+1)}};function a(e){let t=8,n=8,i=e,r=63/128,o=55/128,s=t*n,a=1/t,f=1/n,c=n-Math.floor((i-1)/t)-o,u=(i-1)%t;const h=u*a,d=(u+1)*a,l=(c-1)*f+r*f,p=c*f;return[0,0,0,0,0,0,0,0,d,l,h,l,h,p,d,p]}};t.createMouth=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createHead=void 0;const i=(e,t)=>{const n={index:t},i=t&&new GLTFShape(engine["RESOURCE_BASE"]+`accesories/acc${t}.glb`),r=new Entity;r.addComponent(new Transform({position:new Vector3(0,0,0),rotation:Quaternion.Euler(0,180,0)}));t&&r.addComponent(i);r.setParent(e);return{applyIndex:e=>{if(e!==n.index){const t=new GLTFShape(engine["RESOURCE_BASE"]+`accesories/acc${e}.glb`);r.addComponentOrReplace(t)}},getIndex:()=>n.index}};t.createHead=i}]));